"use client";
import{a,b as u,c as f,d}from"./chunk-Y6UYG3XX.js";import{useEffect as b}from"react";var o,s;function v(e){typeof window>"u"||typeof EventSource>"u"||!e||s||(s=e,o=new EventSource(`${e}/events`),l(),window.addEventListener("vercel-toolbar-ready",()=>{l()}))}function l(){let e=u();e?.isAuthenticated&&e.setLocalhostEventSource?.({subscribe:i,fetchLocal:p})}function i(e,n){if(!o)return()=>{};let r=t=>{try{let c=t.data&&typeof t.data=="string"?JSON.parse(t.data):void 0;c&&n(c)}catch{}};return o.addEventListener(e,r),()=>{o?.removeEventListener(e,r)}}async function p(e,n){if(!s)return{error:"No toolbar server"};try{let r=await fetch(`${s}${e}`,n?{method:"POST",body:JSON.stringify(n)}:void 0),t=await r.json();return r.ok?{result:t}:{error:t.error}}catch(r){return{error:`${r}`}}}async function m(){let e=await p("/branch");return"result"in e?e.result.branch:void 0}function E(){i("branch-change",e=>{e&&location.reload()})}function N(){return process.env.NODE_ENV!=="development"||b(()=>(v(process.env.NEXT_PUBLIC_VERCEL_TOOLBAR_SERVER),E(),m().then(e=>{e&&a(e),f()}),()=>{d()}),[]),null}export{N as LocalhostController};
