'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var crypto = require('crypto');

/**
 * Sign the given `val` with `secret`.
 */
const sign = (val, secret) => `${val}.${crypto.createHmac('sha256', secret).update(val).digest('base64').replace(/=+$/, '')}`;
/**
 * Unsign and decode the given `val` with `secret`,
 * returning `false` if the signature is invalid.
 */
const unsign = (val, secret) => {
    const str = val.slice(0, val.lastIndexOf('.')), mac = sign(str, secret), macBuffer = Buffer.from(mac), valBuffer = Buffer.alloc(macBuffer.length);
    valBuffer.write(val);
    return crypto.timingSafeEqual(macBuffer, valBuffer) ? str : false;
};

exports.sign = sign;
exports.unsign = unsign;
